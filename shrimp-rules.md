# Development Guidelines

This document serves as the specialized guideline for AI Agents executing development tasks in the `mcp-shrimp-task-manager` project.

## 1. Project Overview

- **Project Name**: `mcp-shrimp-task-manager`
- **Purpose**: A task management tool designed for AI Agents, emphasizing thought chains, reflection, and style consistency. It converts natural language into structured development tasks with dependency tracking and iterative optimization capabilities.
- **Technology Stack**:
  - Primary Language: TypeScript
  - Runtime Environment: Node.js (ES Module)
  - Main Frameworks/Libraries: Express.js (for potential API or WebGUI), Zod (for data validation)
  - Package Manager: npm
- **Core Features**:
  - Natural language task parsing
  - Structured task generation and management
  - Task dependency tracking
  - Task execution and validation assistance
  - Integration with AI Agent thought processes

## 2. Project Architecture

- **Main Source Code Directory**: `src/`
  - `src/index.ts`: Main application entry point or module export point. **Modifications to this file require careful impact assessment.**
  - `src/utils/`: Common utility functions.
  - `src/types/`: TypeScript type definitions. **When adding or modifying types, ensure consistency with Zod schemas (if applicable).**
  - `src/tools/`: Project-specific tools or modules for external service integration.
  - `src/models/`: Data model definitions (possibly related to Zod schemas).
  - `src/prompts/`: AI interaction-related prompt templates. **When modifying or adding prompts, consider potential impacts on AI Agent behavior.**
  - `src/public/`: WebGUI or other static resources.
  - `src/tests/`: Unit tests and integration tests.
- **Compilation Output Directory**: `dist/` (This directory is automatically generated by `tsc`, **manual modification of this directory content is prohibited**).
- **Configuration Files**:
  - `package.json`: Project dependencies and scripts. **After adding dependencies, must run `npm install`.**
  - `tsconfig.json`: TypeScript compilation configuration. **Unless necessary, modifying `"strict": true` setting is prohibited.**
  - `.env.example` & `.env`: Environment variable configuration. **Sensitive information must not be committed to version control.**
- **Documentation**:
  - `README.md`: Main project documentation.
  - `docs/`: May contain more detailed architecture, API documentation, etc.
  - `CHANGELOG.md`: Version change records. **Must be updated before each new version release.**
  - `data/WebGUI.md`: Contains links to the Task Manager UI.

## 3. Code Standards

### 3.1. Naming Conventions

- **Variables and Functions**: Use camelCase.
  - _Example (Do)_: `const taskName = "example"; function processTask() {}`
  - _Example (Don't)_: `const Task_Name = "example"; function Process_Task() {}`
- **Classes and Interfaces**: Use PascalCase.
  - _Example (Do)_: `class TaskManager {}; interface ITaskOptions {}`
  - _Example (Don't)_: `class taskManager {}; interface iTaskOptions {}`
- **File Names**: Use camelCase or kebab-case for `.ts` files.
  - _Example (Do)_: `taskProcessor.ts`, `task-utils.ts`
  - _Example (Don't)_: `TaskProcessor.ts`, `task_utils.ts`
- **Constants**: Use UPPER_SNAKE_CASE.
  - _Example (Do)_: `const MAX_RETRIES = 3;`
  - _Example (Don't)_: `const maxRetries = 3;`

### 3.2. Formatting Requirements

- **Indentation**: Use 2 spaces for indentation. **Tab characters are prohibited.**
- **Semicolons**: Every statement must end with a semicolon.
- **Quotes**: String literals should preferentially use single quotes (`'`), unless the string itself contains single quotes.
  - _Example (Do)_: `const message = 'Hello World'; const complex = "It's complex";`
  - _Example (Don't)_: `const message = "Hello World";`
- **Maximum Line Length**: Recommended not to exceed 120 characters.
- **Comments**:
  - Single-line comments use `//`.
  - Multi-line comments use `/* ... */`.
  - JSDoc-style comments should be used for public functions, classes, and methods.
    - _Example (Do)_:
      ```typescript
      /**
       * Processes a given task.
       * @param taskId The ID of the task to process.
       * @returns True if successful, false otherwise.
       */
      function processTaskById(taskId: string): boolean {
        // implementation
        return true;
      }
      ```

### 3.3. TypeScript-Specific Standards

- **Type Annotations**: All function parameters, return values, and variable declarations should have explicit type annotations. **Using `any` type is prohibited unless in extremely special and unavoidable circumstances, and requires explanatory comments.**
  - _Example (Do)_: `function greet(name: string): string { return \`Hello, ${name}\`; }`
  - _Example (Don't)_: `function greet(name): any { return "Hello, " + name; }`
- **Interfaces and Type Aliases**: Prefer interfaces to define object shapes, use type aliases for union types, tuples, or other complex types.
- **ES Module**: Use `import` and `export` syntax.
  - _Example (Do)_: `import { Task } from './models/task'; export class TaskService {}`
  - _Example (Don't)_: `const Task = require('./models/task'); module.exports = TaskService;`
- **Strict Mode**: The project has enabled `"strict": true`. All TypeScript strict mode errors must be resolved.

## 4. Feature Implementation Standards

### 4.1. General Principles

- **Single Responsibility Principle (SRP)**: Each function and class should be responsible for only one functionality.
- **Keep It Simple (KISS)**: Avoid overly complex solutions.
- **Reusability**: Extract common logic as reusable functions or classes whenever possible, storing them in `src/utils/` or related modules.
- **Error Handling**:
  - Use `try...catch` to handle expected errors.
  - For critical operations, provide clear error messages.
  - Consider using custom error classes to provide richer error information.
- **Logging**:
  - Add logging for critical operations, error handling, and important state changes.
  - Consider using structured logging.
  - **Sensitive information (such as passwords, API Keys) must not be logged.**

### 4.2. Zod Usage

- Data structure definitions located in `src/models/` or `src/types/` should preferentially use Zod schemas for definition and validation.
- Zod schemas should stay synchronized with TypeScript types. Use `z.infer<typeof schema>` to generate types.

  - _Example (Do)_:

    ```typescript
    import { z } from "zod";

    export const TaskSchema = z.object({
      id: z.string().uuid(),
      name: z.string().min(1),
      description: z.string().optional(),
    });

    export type Task = z.infer<typeof TaskSchema>;
    ```

### 4.3. Express.js Usage (if API/WebGUI exists)

- Route definitions should be clear and follow RESTful principles (if API).
- Middleware should be effectively organized, such as error handling middleware, logging middleware, etc.
- All external inputs (request parameters, body, query) **must** be validated through Zod or similar mechanisms.

## 5. Framework/Plugin/Third-party Library Usage Standards

- **Adding Dependencies**:
  - **Must** first evaluate the necessity, maintenance status, and security of dependencies.
  - Use `npm install <package-name>` (for runtime dependencies) or `npm install --save-dev <package-name>` (for development dependencies).
  - **Must** specify explicit version ranges in `package.json` (e.g., `^1.2.3` or `~1.2.3`), avoid using `*`.
- **Updating Dependencies**: Regularly check and update dependencies to the latest stable versions to get security patches and new features. Assess potential breaking changes before updating.
- **Removing Dependencies**: If a dependency is no longer needed, use `npm uninstall <package-name>` to remove it and remove related references from the code.

## 6. Workflow Standards

### 6.1. Development Process

1.  **Understand Tasks**: Carefully read task descriptions, requirements, and acceptance criteria.
2.  **Branch Management**: Create new feature branches from the latest `main` (or `develop`) branch. Branch names should be concise and clear, e.g., `feature/add-task-editing` or `fix/login-bug`.
3.  **Coding and Testing**:
    - Code according to this specification.
    - **Must** write unit tests for new features or fixed bugs (stored in `src/tests/`).
    - Run `npm run build` to ensure code compiles successfully.
    - Locally run `npm run dev` or `npm run start` for testing.
4.  **Code Commits**:
    - Git commit messages should follow Conventional Commits specification (e.g., `feat: add user authentication`, `fix: resolve issue with task sorting`).
    - **Committing code containing `console.log` or other debug messages to main branches is prohibited.**
5.  **Pull Request (PR)**:
    - Push feature branch to remote repository and create Pull Request to `main` (or `develop`) branch.
    - PR description should clearly explain changes and reasons.
6.  **Code Review**: Wait for other developers or AI Agent to perform Code Review.
7.  **Merge and Deploy**: After Code Review passes, merge PR. Deployment process depends on project configuration.

### 6.2. Version Control (Git)

- **Main Branches**:
  - `main`: Represents stable and deployable product versions.
  - `develop` (if used): Represents the latest version under development.
- **Commit Frequency**: Recommend small steps with quick iterations, frequently committing meaningful changes.
- **Conflict Resolution**: When merging or rebasing branches, if conflicts occur, **must** carefully resolve them, ensuring code correctness and completeness.

### 6.3. CHANGELOG Updates

- Before releasing new versions, **must** update `CHANGELOG.md`.
- Records should include version number, release date, and lists of new features, bug fixes, and breaking changes.

## 7. Key File Interaction Standards

- **Modifying `src/types/` or `src/models/` (especially Zod schemas)**:
  - **Must** check and update all files referencing these types or schemas to ensure type consistency.
  - **Must** re-run related tests.
- **Modifying `src/index.ts`**:
  - If module export API is modified, **must** check all projects or files depending on this module and make corresponding adjustments.
- **Modifying `package.json` (especially `dependencies` or `scripts`)**:
  - **Must** notify team members or related AI Agents to run `npm install`.
  - If modifying `scripts`, ensure CI/CD processes (if any) are also updated accordingly.
- **Modifying `.env.example`**:
  - **Must** synchronously update all development environment `.env` files and notify team members.
- **Modifying `README.md` or documentation in `docs/`**:
  - If changes involve core functionality or usage methods, **must** ensure accuracy and timeliness of documentation content.

## 8. AI Decision Standards

### 8.1. Handling Ambiguous Requests

- When receiving ambiguous development instructions (e.g., "optimize task list display"):
  1.  **Attempt Clarification**: If possible, request more specific details or expected results from users or task initiators.
  2.  **Analyze Context**: Check related code (`src/`), existing UI (if any), related issues (if any) to infer possible intentions.
  3.  **Propose Solutions**: Based on analysis, propose 1-2 specific implementation solutions, explaining their pros/cons and estimated workload.
  4.  **Wait for Confirmation**: Do not make large-scale code modifications before receiving clear instructions.

### 8.2. Error/Exception Handling Strategy

- **Priority**:
  1.  **User Experience**: Avoid application crashes, provide friendly error messages.
  2.  **Data Integrity**: Ensure errors don't cause data corruption or inconsistency.
  3.  **System Stability**: Log detailed error information for troubleshooting.
- **Choices**:
  - For predictable errors (e.g., invalid user input), handle them in the context of that operation and provide feedback.
  - For unexpected system errors, catch, log, and possibly throw up or trigger global error handling mechanisms.

### 8.3. Dependency Selection

- When needing to introduce new third-party libraries:
  1.  **Check Existing**: Confirm whether similar libraries that can meet requirements already exist in the project.
  2.  **Evaluate Options**:
      - **Activity and Community Support**: Choose well-maintained libraries with active communities.
      - **Lightweight**: Avoid introducing overly large or functionally redundant libraries.
      - **Security**: Check for known security vulnerabilities.
      - **License Terms**: Ensure compatibility with project license.
  3.  **Minimization Principle**: Only introduce libraries that are actually needed.

## 9. Prohibited Actions

- **Direct modification of any files in the `dist/` directory is prohibited.** This directory contains compiled artifacts.
- **Assuming new dependencies are available without running `npm install` is prohibited.**
- **Direct commits of untested or incomplete code to main branches (`main` or `develop`) is prohibited.** Must use feature branches.
- **Committing code containing API Keys, passwords, or other sensitive information to version control is prohibited.** Use `.env` files to manage such information.
- **Major modifications to core architecture or public APIs without notification or consent is prohibited.**
- **Ignoring TypeScript type errors is prohibited.** All errors reported by `tsc` must be resolved.
- **Using `any` type without sufficient reason and comments is prohibited.**
- **Leaving extensive `console.log` or other temporary debug code in the codebase is prohibited.**
- **Releasing new versions without updating `CHANGELOG.md` is prohibited.**
- **Introducing third-party libraries incompatible with the project's MIT license is prohibited.**

## 10. Updating This Guidelines Document (`shrimp-rules.md`)

- When the project's technology stack, core architecture, main workflows, or important standards change, this document **must** be updated synchronously.
- Update requests should clearly specify sections and content that need changes.
- If receiving ambiguous "update rules" instructions, AI Agent **must**:
  1.  Autonomously analyze current codebase changes (e.g., `git diff`, recent commits).
  2.  Compare existing `shrimp-rules.md` with current project state, finding inconsistent or outdated rules.
  3.  List inferred update points and their reasoning during the `process_thought` phase.
  4.  Propose specific modification suggestions or directly edit this document.
  5.  **Strictly prohibited** from seeking clarification from users about ambiguous requests before performing autonomous analysis.

---

These development guidelines aim to ensure AI Agents can participate in the development of the `mcp-shrimp-task-manager` project efficiently, consistently, and safely.
